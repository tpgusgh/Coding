<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title>ì§€ë¢°ì°¾ê¸° ê²Œì„</title>
        <style>
            body {
                font-family: sans-serif;
                text-align: center;
                margin-top: 30px;
            }
            h1 {
                margin-bottom: 10px;
            }
            #minefield {
                display: inline-block;
                border: 2px solid #333;
                user-select: none; /* ë“œë˜ê·¸ ë°©ì§€ */
            }
            .row {
                display: flex;
            }
            .cell {
                width: 40px;
                height: 40px;
                background-color: #ccc;
                border: 1px solid #999;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                cursor: pointer;
            }
            .cell.revealed {
                background-color: #eee;
                cursor: default;
            }
            .cell.mine {
                background-color: #f66;
            }
            .cell.flag::after {
                content: "â›³";
                color: #e74c3c;
                font-size: 20px;
            }
        </style>
    </head>
    <body>
        <h1>ì§€ë¢°ì°¾ê¸°</h1>
        <button id="resetBtn">ì¬ì‹œì‘</button>
        <div id="minefield"></div>

        <script>
            // ì§€ë¢°ì°¾ê¸° ê¸°ë³¸ ì„¤ì •
            const rows = 8;
            const cols = 8;
            const mineCount = 10;

            let boardData = []; // ì§€ë¢° ë° ìˆ«ì ì •ë³´ê°€ ì €ì¥ë˜ëŠ” 2ì°¨ì› ë°°ì—´

            const minefield = document.getElementById("minefield");
            const resetBtn = document.getElementById("resetBtn");

            //=============== ì´ˆê¸°í™” & ë³´ë“œ ìƒì„± ë¡œì§ ===============//
            function initGame() {
                // ë‚´ë¶€ ë°ì´í„° ì´ˆê¸°í™”
                boardData = [];
                minefield.innerHTML = ""; // í™”ë©´ì—ì„œ ì´ˆê¸°í™”

                // 1) 2ì°¨ì› ë°°ì—´ êµ¬ì¡° ì¤€ë¹„
                for (let r = 0; r < rows; r++) {
                    boardData[r] = [];
                    for (let c = 0; c < cols; c++) {
                        boardData[r][c] = {
                            mine: false,
                            revealed: false,
                            flagged: false,
                            neighbor: 0, // ì£¼ë³€ ì§€ë¢° ìˆ˜
                        };
                    }
                }

                // 2) ì§€ë¢° ë°°ì¹˜
                placeMines();

                // 3) ì£¼ë³€ ì§€ë¢° ìˆ˜ ê³„ì‚°
                calculateNeighborCounts();

                // 4) HTML ì—˜ë¦¬ë¨¼íŠ¸(ì¹¸) ìƒì„±
                renderBoard();
            }

            // ë¬´ì‘ìœ„ ìœ„ì¹˜ì— mineCountê°œì˜ ì§€ë¢° ë°°ì¹˜
            function placeMines() {
                let placed = 0;
                while (placed < mineCount) {
                    const r = Math.floor(Math.random() * rows);
                    const c = Math.floor(Math.random() * cols);
                    if (!boardData[r][c].mine) {
                        boardData[r][c].mine = true;
                        placed++;
                    }
                }
            }

            // ì£¼ë³€ 8ì¹¸ì˜ ì§€ë¢° ìˆ˜ ê³„ì‚°
            function calculateNeighborCounts() {
                const directions = [
                    [-1, -1],
                    [-1, 0],
                    [-1, 1],
                    [0, -1],
                    [0, 1],
                    [1, -1],
                    [1, 0],
                    [1, 1],
                ];

                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        if (boardData[r][c].mine) {
                            boardData[r][c].neighbor = -1; // ì§€ë¢° í‘œì‹œ
                        } else {
                            let count = 0;
                            directions.forEach(([dr, dc]) => {
                                const nr = r + dr;
                                const nc = c + dc;
                                if (
                                    nr >= 0 &&
                                    nr < rows &&
                                    nc >= 0 &&
                                    nc < cols
                                ) {
                                    if (boardData[nr][nc].mine) {
                                        count++;
                                    }
                                }
                            });
                            boardData[r][c].neighbor = count;
                        }
                    }
                }
            }

            // ë³´ë“œ(HTML) ìƒì„±
            function renderBoard() {
                for (let r = 0; r < rows; r++) {
                    const rowDiv = document.createElement("div");
                    rowDiv.classList.add("row");
                    for (let c = 0; c < cols; c++) {
                        const cellDiv = document.createElement("div");
                        cellDiv.classList.add("cell");
                        cellDiv.setAttribute("data-row", r);
                        cellDiv.setAttribute("data-col", c);

                        // ì™¼ìª½ í´ë¦­
                        cellDiv.addEventListener("click", leftClick);
                        // ì˜¤ë¥¸ìª½ í´ë¦­(ë¸Œë¼ìš°ì € ê¸°ë³¸ ë©”ë‰´ ë°©ì§€)
                        cellDiv.addEventListener("contextmenu", (e) => {
                            e.preventDefault();
                            rightClick(e);
                        });

                        rowDiv.appendChild(cellDiv);
                    }
                    minefield.appendChild(rowDiv);
                }
            }

            //=============== í´ë¦­ ì´ë²¤íŠ¸ë“¤ ===============//

            // (1) ì™¼ìª½ í´ë¦­(ì¹¸ ì—´ê¸°)
            function leftClick(e) {
                const cellDiv = e.target;
                const r = parseInt(cellDiv.getAttribute("data-row"));
                const c = parseInt(cellDiv.getAttribute("data-col"));

                const cellData = boardData[r][c];

                // ì´ë¯¸ ì—´ë ¤ìˆê±°ë‚˜ ê¹ƒë°œì´ ìˆëŠ” ì¹¸ì€ ë¬´ì‹œ

                // ì§€ë¢°ë¥¼ í´ë¦­í–ˆë‹¤ë©´ -> ê²Œì„ ì¢…ë£Œ
                // 1. ì§€ë¢° ìœ„ì¹˜ í´ë¦­ ì‹œ ê²Œì„ ì˜¤ë²„ alert ì°½ ì¶œë ¥
                // 2. ì£¼ë³€ ê¹ƒë°œ ê°¯ìˆ˜ì™€ ìˆ«ìê°€ ë™ì¼í•œ ê²½ìš° ì£¼ë³€ ì¹¸ ì—°ì‡„ì ìœ¼ë¡œ ì˜¤í”ˆ
                // 3. ìŠ¹ë¦¬ ì±„í¬ (ëª¨ë“  ì§€ë¢° ì°¾ì•˜ì„ ì‹œ (checkwin()í•¨ìˆ˜ í™œìš©))
            }

            // (2) ì˜¤ë¥¸ìª½ í´ë¦­(ê¹ƒë°œ í‘œì‹œ)
            // 1. ì—´ë ¤ìˆëŠ” ì¹¸ ê¹ƒë°œ í‘œì‹œ ë¶ˆê°€
            // 2. ê¹ƒë°œ ìˆëŠ” ì¹¸ í´ë¦­ ì‹œì—ëŠ” ê¹ƒë°œ ì—†ì–´ì ¸ì•¼ í•¨
            // 3. 2ë²ˆì˜ ë°˜ëŒ€ ê¸°ëŠ¥ ì¶”ê°€
            function rightClick(e) {
                const cellDiv = e.target;
                const r = parseInt(cellDiv.getAttribute("data-row"));
                const c = parseInt(cellDiv.getAttribute("data-col"));
                const cellData = boardData[r][c];
            }

            //=============== ë³´ì¡° í•¨ìˆ˜ë“¤ ===============//

            // í•´ë‹¹ ì¹¸ì˜ ëª¨ìŠµ(ìŠ¤íƒ€ì¼, ìˆ«ì, ë°°ê²½ ë“±) ì—…ë°ì´íŠ¸
            function updateCell(cellDiv, r, c) {
                const cellData = boardData[r][c];
                cellDiv.classList.add("revealed");

                if (cellData.mine) {
                    cellDiv.classList.add("mine");
                    cellDiv.textContent = "ğŸ’£";
                } else if (cellData.neighbor > 0) {
                    cellDiv.textContent = cellData.neighbor;
                } else {
                    // 0ì´ë©´ ë¹ˆì¹¸
                    cellDiv.textContent = "";
                }
            }

            // ì£¼ë³€ ì¹¸ ì—´ê¸°(DFS/BFS í˜•íƒœë¡œ 0ê°’ ì£¼ë³€ ì—°ì‡„ ì˜¤í”ˆ)
            function openSurrounding(r, c) {
                const directions = [
                    [-1, -1],
                    [-1, 0],
                    [-1, 1],
                    [0, -1],
                    [0, 1],
                    [1, -1],
                    [1, 0],
                    [1, 1],
                ];

                directions.forEach(([dr, dc]) => {
                    const nr = r + dr;
                    const nc = c + dc;
                    if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                        const neighborData = boardData[nr][nc];
                        if (!neighborData.revealed && !neighborData.flagged) {
                            neighborData.revealed = true;
                            const neighborCellDiv = document.querySelector(
                                `.cell[data-row='${nr}'][data-col='${nc}']`
                            );
                            updateCell(neighborCellDiv, nr, nc);
                            if (
                                neighborData.neighbor === 0 &&
                                !neighborData.mine
                            ) {
                                openSurrounding(nr, nc);
                            }
                        }
                    }
                });
            }

            // ëª¨ë“  ì§€ë¢° ë“œëŸ¬ë‚´ê¸°
            // (win === true) ì´ë©´ ê¹ƒë°œë§Œ ì¶”ê°€ í‘œê¸°
            function revealAllMines(win = false) {
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        const cellData = boardData[r][c];
                        const cellDiv = document.querySelector(
                            `.cell[data-row='${r}'][data-col='${c}']`
                        );
                        if (cellData.mine && !win) {
                            cellData.revealed = true;
                            updateCell(cellDiv, r, c);
                        }
                        if (cellData.mine && win) {
                            // ê¹ƒë°œ í‘œì‹œ
                            cellDiv.classList.add("flag");
                        }
                    }
                }
            }

            // ëª¨ë“  ì¹¸ í´ë¦­ ë¶ˆê°€
            function disableAllClicks() {
                const allCells = document.querySelectorAll(".cell");
                allCells.forEach((cell) => {
                    cell.style.pointerEvents = "none";
                });
            }

            // ìŠ¹ë¦¬ ì¡°ê±´: ì§€ë¢°ê°€ ì•„ë‹Œ ì¹¸ì´ ì „ë¶€ ì—´ë ¸ëŠ”ì§€
            function checkWin() {
                let openedCount = 0;
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        if (!boardData[r][c].mine && boardData[r][c].revealed) {
                            openedCount++;
                        }
                    }
                }
                const totalSafeCells = rows * cols - mineCount;
                return openedCount === totalSafeCells;
            }

            // ì¬ì‹œì‘ ë²„íŠ¼ í´ë¦­
            resetBtn.addEventListener("click", () => {
                initGame();
            });

            // í˜ì´ì§€ ë¡œë“œë˜ë©´ ìë™ìœ¼ë¡œ ê²Œì„ ì´ˆê¸°í™”
            window.onload = () => {
                initGame();
            };
        </script>
    </body>
</html>
